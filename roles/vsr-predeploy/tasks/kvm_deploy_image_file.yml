- block:

  - include_role:
      name: common
      task_from: copy_qcow2.yml
    vars: 
      dest_filename: "{{ inventory_hostname }}.qcow2"
    when: skipImages is undefined or not skipImages
    

  - block: 
    - name: Check to make sure there is an existing qcow image
      stat: 
        path: "{{ vsr_target_qcow2_file_path }}"
      register: statResult
      
    - name: check the result of image find command
      assert:
        that: statResult.stat.exists == True
        msg: Missing qcow2 file {{ vsr_target_qcow2_file_path }}
        
    when: skipImages is defined and skipImages

  - name: Copy license file to VSR qcow2 image file
    command:
      guestfish --rw \
      -a {{ vsr_target_qcow2_file_path }} \
      -m {{ vsr_partition }} \
      copy-in {{ images_path }}/{{ vmname }}/license.txt /

  delegate_to: "{{ target_server }}"
  remote_user: "{{ target_server_username }}"
