---
- name: Set mgmt ip address
  set_fact:
    mgmt_ip: "{{ mgmt_ip_and_prefix.split('/')[0] }}"

- name: Set netmask
  set_fact:
    mgmt_prefix: "{{ mgmt_ip_and_prefix.split('/')[1] }}"

- include_role:
    name: check-node-reachability

- name: Get VNSUTIL directory stat
  stat:
    path: /opt/nuage
  remote_user: root
  register: vnsutil_dir
  when: node_reachable

- name: Set fact for VNSUTIL present
  set_fact:
    vnsutil_present: "{{ vnsutil_dir is defined and
                         vnsutil_dir.stat is defined and
                         vnsutil_dir.stat.isdir is defined and
                         vnsutil_dir.stat.isdir }}"

- include: kvm.yml
  when: target_server_type | match("kvm")
  tags:
    - vnsutil
    - vnsutil-predeploy

- include: vcenter.yml
  when: target_server_type | match("vcenter")
  static: no
  tags:
    - vnsutil
    - vnsutil-predeploy
