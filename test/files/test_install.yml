---
- include: destroy_everything.yml
#- include: install_everything.yml

#- include: vsc_destroy.yml
#- include: vrs_destroy.yml
#- include: vstat_destroy.yml
#- include: vnsutil_destroy.yml
#- include: nsgv_destroy.yml

- include: vsd_predeploy.yml
- include: vsd_deploy.yml

- include: vsc_predeploy.yml
- include: vsc_deploy.yml
- include: vsc_postdeploy.yml

- hosts: vscs
  gather_facts: no
  tasks:
  - name: Wait for VSC ssh to be ready after VSC Deploy
    local_action:
      module: wait_for
      port: "22"
      host: "{{ mgmt_ip }}"
      search_regex: OpenSSH
      delay: 1

- include: vrs_predeploy.yml
- include: vrs_deploy.yml
- include: vrs_postdeploy.yml

- include: vstat_predeploy.yml
- include: vstat_deploy.yml
- include: vstat_postdeploy.yml

- hosts: vscs
  gather_facts: no
  tasks:
  - name: Wait for VSC ssh to be ready after VSTAT Deploy
    local_action:
      module: wait_for
      port: "22"
      host: "{{ mgmt_ip }}"
      search_regex: OpenSSH
      delay: 1

- include: vcin_predeploy.yml
- include: vcin_deploy.yml

- hosts: vscs
  gather_facts: no
  tasks:
  - name: Wait for VSC ssh to be ready before VNS Deploy
    local_action:
      module: wait_for
      port: "22"
      host: "{{ mgmt_ip }}"
      search_regex: OpenSSH
      delay: 1

- include: vns_deploy.yml
- include: vns_postdeploy.yml

- include: vnsutil_predeploy.yml
- include: vnsutil_deploy.yml
- include: vnsutil_postdeploy.yml

- include: nsgv_predeploy.yml
