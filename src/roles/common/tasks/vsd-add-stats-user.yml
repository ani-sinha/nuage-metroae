---
# Playbook to add a user to the Stats group
#
# Required variables:
# - nuage_auth: dict used as authentication parameter for the nuage_vspk calls
# - cms_user_name (default: csproot)
#
# It assumes the tasks to be delegated to a server that has the
# nuage vspk python module installed.

- name: Get CSP Enterprise ID
  nuage_vspk:
    auth: "{{ nuage_auth }}"
    type: Enterprise
    command: get_csp_enterprise
  register: nuage_csp_enterprise

- name: Create stats user
  nuage_vspk:
    auth: "{{ nuage_auth }}"
    type: User
    parent_id: "{{ nuage_csp_enterprise.id }}"
    parent_type: Enterprise
    state: present
    properties:
      userName: "{{ stats_user_user_name | default('statsuser') }}"
      firstName: "{{ stats_user_first_name | default('Statsuser') }}"
      lastName: "{{ stats_user_last_name | default('Statsuser') }}"
      email: "{{ stats_user_email | default('statsuser@csp.com') }}"
      password: "{{ stats_user_password | default(vstat_default_password) }}"
  register: stats_user

- name: Get Stats Group
  nuage_vspk:
      auth: "{{ nuage_auth }}"
      type: Group
      parent_id: "{{ nuage_csp_enterprise.id }}"
      parent_type: Enterprise
      command: find
      properties:
        name: "Stats Group"
  register: stats_group

- name: Assign stats user to Stats Group
  nuage_vspk:
    auth: "{{ nuage_auth }}"
    type: User
    id: "{{ stats_user.id }}"
    parent_id: "{{ stats_group.id }}"
    parent_type: Group
    state: present

