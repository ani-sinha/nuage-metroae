- block:

  - name: Set netconf username
    set_fact:
      netconf_username: netconfmgr

  - name: Set netconf password
    set_fact: 
      netconf_password: password

  - name: Create Netconf Manager User
    set_fact:
      netconf_manager_user:
          email: "user@example.met"
          firstName: "Netconfmgr"
          lastName: "Netconfmgr"
          password: "password"
          netconf_user: "netconfmgr"

  - name: Create Netconf Manager User and Group
    create_netconf_manager:
      vsd_auth: "{{ vsd_auth }}"
      netconf_manager_user: "{{ netconf_manager_user }}"
    delegate_to: localhost

  - name: Create Netconf Manager Certs
    include_role:
      name: common
      tasks_from: vsd-generate-transfer-certificates
    vars:
      certificate_password: "{{ vstat_default_password }}"
      certificate_username: "{{ netconf_username }}"
      commonName: "{{ netconf_username }}"
      certificate_type: client
      additional_parameters:  -p {{ netconf_password }}
      file_type: jks

  remote_user: "{{ vsd_custom_username | default(vsd_default_username) }}"
  become: "{{ 'no' if vsd_custom_username | default(vsd_default_username) == 'root' else 'yes' }}"
  vars:
    ansible_become_pass: "{{ vsd_custom_password | default(vsd_default_password) }}"
