---
- block:
  - name: Display if skipping predeploy
    debug:
      msg:
        - "****************************************************"
        - "Skipping VNSUTIL predeploy as vnsutil_predeploy is in skip actions"
        - "****************************************************"

  - name: Stop playbook
    meta: end_play

  when: '"vnsutil_predeploy" in skip_actions'

- include_role:
    name: check-node-reachability

- name: Get VNSUTIL directory stat
  stat:
    path: /opt/nuage
  remote_user: "{{ vnsutil_default_username }}"
  register: vnsutil_dir
  when: node_reachable

- name: Set fact for VNSUTIL present
  set_fact:
    vnsutil_present: "{{ vnsutil_dir is defined and
                         vnsutil_dir.stat is defined and
                         vnsutil_dir.stat.isdir is defined and
                         vnsutil_dir.stat.isdir }}"

- import_tasks: kvm.yml
  when: target_server_type is match("kvm")
  tags:
    - vnsutil
    - vnsutil-predeploy

- import_tasks: vcenter.yml
  when: target_server_type is match("vcenter")
  static: no
  tags:
    - vnsutil
    - vnsutil-predeploy

- import_tasks: aws.yml
  when: target_server_type is match("aws")
  tags:
    - vnsutil
    - vnsutil-predeploy

- import_tasks: nuagex.yml
  when: target_server_type is match("nuagex")
  static: no
  tags:
    - nuagex
    - vnsutil
    - vnsutil-predeploy
