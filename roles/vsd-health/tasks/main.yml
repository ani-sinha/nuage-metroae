---
- name: Create report folder on ansible deployment host
  file:
    path: "{{ playbook_dir}}/reports/"
    state: directory
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Set path to write report
  set_fact:
    report_path: "{{ playbook_dir }}/reports/{{ report_filename }}"

- name: Clean up tmp files from previous runs
  file: 
    path: "{{ report_path }}" 
    state: absent
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Write title to report file
  nuage_append: filename="{{ report_path }}" text="VSD Health Report Start\n"
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Write date to report file
  nuage_append: filename="{{ report_path }}" text="{{ ansible_date_time.date }}@{{ ansible_date_time.time }}\n"
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Write seperator to report file
  nuage_append: filename="{{ report_path }}" text="================================================================================\n"
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Get current network config of all VSD nodes
  network_info:
    mac_addr: False
  register: net_conf
 
- name: Print network config when verbosity >= 1
  debug: var=net_conf.info verbosity=1
 
- name: Write network config to json file
  nuage_append: filename="{{ report_path }}" text="{{ net_conf.info | to_nice_json}}\n"
  delegate_to: "{{ ansible_deployment_host }}"
  remote_user: root

- name: Write seperator to report file
  nuage_append: filename="{{ report_path }}" text="================================================================================\n"
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true

- name: Write title to report file
  nuage_append: filename="{{ report_path }}" text="VSD Health Report End\n"
  remote_user: root
  delegate_to: "{{ ansible_deployment_host }}"
  run_once: true
