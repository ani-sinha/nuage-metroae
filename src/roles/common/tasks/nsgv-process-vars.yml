- block:

  - name: Verify that OpenFlow is set to use TLS (required for NSGv)
    assert:
      that: openflow_tls | default(true)
      msg: "openflow_tls is False. It must be undefined (default) or set to True in common.yml to support NSGv. Quitting."

  - name: Set NSGV KVM image location
    include_role:
      name: common
      tasks_from: find-image.yml
    vars:
      pattern: ncpe_centos7.qcow2
    when: nsgvs | map(attribute='target_server_type') | list is issuperset(["kvm"])

  - name: Set NSGV vCenter image location
    include_role:
      name: common
      tasks_from: find-image.yml
    vars:
      pattern: NSG-*.ovf
    when: nsgvs | map(attribute='target_server_type') | list is issuperset(["vcenter"])

  - name: Create host_vars files for nsgvs
    include_tasks: write-host-files.yml
    vars:
      component_template: nsgv
      component_hostname : "{{ component.vmname }}"
    loop_control:
      loop_var: component
    with_items: "{{ nsgvs }}"

  when: nsgvs is defined and nsgvs
