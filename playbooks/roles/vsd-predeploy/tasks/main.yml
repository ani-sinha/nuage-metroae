---
- name: Ping VSD hostname
  command: ping -c 1 {{ hostname }}
  ignore_errors: yes
  register: ping_result
  delegate_to: localhost

- name: Assert no response to ping of VSD hostname
  assert:
    that: "'100% packet loss' in ping_result.stdout"
    msg:  "Someone responded to ping of VSD hostname. Quitting."

- name: Ping VSD IP address
  command: ping -c 1 {{ mgmt_ip }}
  ignore_errors: yes
  register: ping_result
  delegate_to: localhost

- name: Assert no response to ping of VSD IP address
  assert:
    that: "'100% packet loss' in ping_result.stdout"
    msg:  "Someone responded to ping of VSD IP address. Quitting."

- include: kvm.yml
  when: target_server_type | match("kvm")
  tags:
    - vsd
    - vsd-predeploy

- include: heat.yml
  when: target_server_type | match("heat")
  tags:
    - vsd
    - heat
    - vsd-predeploy

- include: vcenter.yml
  when: target_server_type | match("vcenter")
  tags:
    - vsd
    - vsd-predeploy
