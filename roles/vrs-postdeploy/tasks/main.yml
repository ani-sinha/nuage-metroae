---
- name: Wait for active VSC ssh to be ready
  local_action:
    module: wait_for
    port: "22"
    host: "{{ active_controller_addr }}"
    search_regex: OpenSSH
    delay: 1

- name: Get ovs-vsctl show output
  command: ovs-vsctl show
  register: ovs_show_result
  remote_user: root

- name: Create a temporary directory
  local_action: file path={{ playbook_dir }}/scripts/tmp  state=directory

- name: Copy ovs-vsctl show output to a temporary file
  local_action: copy content={{ ovs_show_result.stdout }} dest={{ playbook_dir }}/scripts/tmp/{{ inventory_hostname }}.tmp

- name: Run verification script for OVS show command
  local_action: command python {{ playbook_dir }}/scripts/ovs_result_verify.py {{ node_ip_addr }} {{ inventory_hostname }}.tmp {{ playbook_dir }}
  register: ovs_show_result

- name: Run verification script for VRS
  local_action: command python {{ playbook_dir }}/scripts/vrs_verify.py {{ node_ip_addr }} {{ active_controller_addr }} {{ standby_controller_addr }} {{ playbook_dir }} "{{ ovs_show_result.stdout }}"
  register: pass

- name: Delete the temporary directory
  local_action: file path={{ playbook_dir }}/scripts/tmp state=absent

- name: Verification Result Failure Status
  fail: msg={{ pass.stdout }}
  when: pass.stdout | search("(?i)Error")

- name: Verification Result Success Status
  debug: var=pass.stdout
