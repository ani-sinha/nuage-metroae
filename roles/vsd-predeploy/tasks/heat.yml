---
# TODO:
# Check for existing stack or vms
- name: Creating VSD stack
  register: create_stack
  os_stack:
    name: "{{ inventory_hostname }}"
    template: "roles/vsd-predeploy/files/vsd.yml" 
    auth:
      "{{ os_auth }}"
    parameters:
      vm_name: "{{inventory_hostname}}"
      vsd_image: "{{ vsd_image }}"
      vsd_flavor: "{{ vsd_flavor }}"
      vsd_net: "{{ vsd_network }}"
      ssh_key: "{{ansible_user_ssh_key}}"
  delegate_to: 127.0.0.1
- debug: var=create_stack['stack']['outputs'][0]['output_value']
