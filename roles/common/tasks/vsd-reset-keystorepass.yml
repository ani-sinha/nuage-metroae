---

- block:
  - name: Check if the default keystore password is valid
    command: keytool -list -keystore /usr/java/latest/lib/security/cacerts -storepass changeit
    register: keytool_output
    ignore_errors: yes
  - name: Check keytool result
    fail: msg="The keystore password has been changed from the default, please set 'vsd_keystore_password' and re-run"
    fail_when: keytool_output.rc != 0
  remote_user: root
  when: vsd_keystore_password is not defined
  
- name: If a custom keystore password is used, reset it back to default
  command: keytool -storepasswd -new changeit -keystore /usr/java/latest/lib/security/cacerts -storepass {{vsd_keystore_password}}
  remote_user: root
  when: vsd_keystore_password is defined
  