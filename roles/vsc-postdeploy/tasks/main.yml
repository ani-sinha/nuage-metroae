---

- name: Check VSC Health after deployment
  include_role: name="vsc-health"
  vars:
    report_filename: vsc-postdeploy-health.yml
  delegate_to: "{{ ansible_deployment_host }}"

- name: Get NTP status
  sros_command:
      commands:
        - show system ntp | match "Clock Source"
      provider: "{{ vsc_creds }}"
  register: ntp_status
  until: not ntp_status.stdout[0]|search('none')
  retries: "{{ ntp_sync_retries }}"
  delay: "{{ ntp_sync_delay }}"
  delegate_to: localhost
  ignore_errors: yes

- name: Verify NTP status
  assert:
   that: not ntp_status.stdout[0]|search('none')
   msg: "NTP Status not okay: {{ ntp_status.stdout[0] }}. Quitting."
