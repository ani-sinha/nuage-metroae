- name: Clean known_hosts of VSD's (ignoring errors)
  known_hosts:
    name: "{{ hostname }}"
    state: absent
  delegate_to: localhost
  no_log: True
  ignore_errors: True

- name: Wait for VSD ssh to be ready
  include_role:
    name: common
    tasks_from: wait-for-ssh
  vars:
    ssh_host: "{{ hostname }}"
    host_username: "{{ vsd_default_username }}"

- name: Generate SSL certificates for the web filtering VM

- name: Copy the generated certificate to the web filtering VM in the following location /opt/vsd/webfilter/conf/webfilter.jks

- name: Copy the truststore.jks file from the VSD to the web filtering VM in the following location /opt/vsd/webfilter/conf/truststore.jks

- name: Verify that the /opt/vsd/webfilter/conf/application.properties file has the
        server.ssl.key-store=/opt/vsd/webfilter/conf/webfilter.jks
        server.ssl.key-store-password=<your-ks-password>
        server.ssl.key-alias=webfilter
        server.ssl.trust-store=/opt/vsd/webfilter/conf/truststore.jks
        server.ssl.trust-store-password=<your-ts-password>
- name: Execute the following commands to stop and restart the web filtering process
        monit stop webfilter
        monit summary
        Process 'webfilter' Not monitored
        Program 'webfilter-status' Not monitored
        Process 'incompass-34-seed' Running
        Program 'incompass-34-seed-status' Status ok
        Process 'incompass' Running
        Program 'incompass-status' Status ok
        System 'localhost.localdomain' Running
- name: monit start webfilter-status
        monit summary
        Process 'webfilter' Running
        Program 'webfilter-status' Status ok
        Process 'incompass-34-seed' Running
        Program 'incompass-34-seed-status' Status ok
        Process 'incompass' Running
        Program 'incompass-status' Status ok
        System 'localhost.localdomain' Running
- name: Execute the monit summary command to ensure the services are operational

- name: /opt/vsd/webfilter/scripts/incompassOperations.sh -a all -p /opt/vsd/webfilter/seed_34
        /opt/vsd/webfilter/scripts/incompassOperations.sh -a all

- name: Execute the monit summary command again to ensure the services are still operational after
        the database download and update.

- name: Connect with the NSG
