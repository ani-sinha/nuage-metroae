---
- name: Wait for VSD ssh to be ready
  local_action:
    module: wait_for
    port: "22"
    host: "{{ mgmt_ip }}"
    search_regex: OpenSSH
    delay: 1

- name: "Check if monit summary is already up"
  command: monit summary
  ignore_errors: yes
  register: monit_result
  remote_user: root

- include: non_heat.yml
  when: monit_result.rc != 0 and not target_server_type | match("heat")
  tags:
    - vsd
    - vsd-deploy

- include: heat.yml
  when: monit_result.rc != 0 and target_server_type | match("heat")
  tags:
    - vsd
    - heat
    - vsd-deploy
