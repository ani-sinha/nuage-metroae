---
- name: Get VSD nodes network and monit information prior to upgrade
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_pre_upgrade_report.txt
  roles:
    - vsd-health

- name: Get VSC nodes information prior to upgrade
  include: vsc_health.yml report_filename=vsc_pre_upgrade_report.txt

- name: Decouple VSD node1 and node3
  include: vsd_decluster.yml

- name: Upgrade VSD Node1 and Node3
  hosts: vsd_ha_node1:vsd_ha_node3
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsd-upgrade

- name: Get VSD nodes network and monit information post VSD1 and VSD3 upgrade after enabling VSD API
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_post_vsd1_3_upgrade_report.txt
  roles:
    - vsd-health

- name: Get VSC nodes information prior to upgrade VSC1 
  include: vsc_health.yml report_filename=vsc_pre_vsc1_upgrade_report.txt

- name: Backup VSC node1
  hosts: vsc_ha_node1
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsc-backup

- name: Upgrade VSC node1
  hosts: vsc_ha_node1
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsc-upgrade

- name: Get VSC nodes information post VSC1 upgrade
  include: vsc_health.yml report_filename=vsc_post_vsc1_upgrade_report.txt

- name: Gather network and monit information of VSDs after VSC1 upgrade
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_post_vsc1_upgrade_report.txt
  roles:
    - vsd-health

- name: Upgrade VSC node2
  hosts: vsc_ha_node2
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsc-upgrade

- name: Get VSC nodes information post VSC2 upgrade
  include: vsc_health.yml report_filename=vsc_post_vsc2_upgrade_report.txt

- name: Upgrade VSD node2
  hosts: vsd_ha_node2
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsd-upgrade 

- name: Gather network and monit information of all VSD's post upgrade
  hosts: vsds
  any_errors_fatal: true
  vars:
    report_filename: vsd_post_upgrade_report.txt
  roles:
    - vsd-health

- name: Get VSC nodes information post upgrade
  include: vsc_health.yml report_filename=vsc_post_upgrade_report.txt
