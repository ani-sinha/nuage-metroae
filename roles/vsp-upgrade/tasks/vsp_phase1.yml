---
#- name: Query facts on ansible_deployment_host
#  action: setup
#  run_once: true
#  delegate_to: "{{ ansible_deployment_host }}"
#  remote_user: "{{ ansible_sudo_username }}"
#
#- name: Get VSD nodes network and monit information prior to upgrade
#  any_errors_fatal: true
#  vars:
#    report_filename: vsd_pre_upgrade_report.txt
#  include_role:
#    name: vsd-health
#  when: inventory_hostname in groups['vsds']
#
#- name: Get VSC nodes information prior to upgrade
#  any_errors_fatal: true
#  vars:
#    report_filename: vsc_pre_upgrade_report.txt
#  include_role:
#    name: vsc-health
#  when: inventory_hostname in groups['vscs']
#  
#- name: Perform vsd database backup
#  include_role:
#    name: vsd-dbbackup
#  when: inventory_hostname in groups['vsds']
#
#- name: Decouple VSD node1 and node3
#  vars:
#    report_filename: vsd_decluster_report.txt
#  include_role:
#    name: vsd-decouple
#  when: 
#    - inventory_hostname in groups['vsds'] 
#    - vsd_sa_or_ha == 'ha'
#
#- name: Stop vsd services gracefully
#  include_role:
#    name: vsd-services-stop
#  when: vsd_sa_or_ha == 'ha'
#
#- block:
#  - name: Upgrade VSD node1 and node3
#    include_role:
#      name: vsd-upgrade
#    when: inventory_hostname in groups['vsd_ha_node1'] or inventory_hostname in ['vsd_ha_node3']
#
#  - name: Get VSD nodes network and monit information post VSD1 and VSD3 upgrade after enabling VSD API
#    any_errors_fatal: true
#    vars:
#      report_filename: vsd_post_vsd1_3_upgrade_report.txt
#    include_role:
#      name: vsd-health
#  when: vsd_sa_or_ha == 'ha'
#
#- block:
#  - name: Upgrade VSD node
#    include_role:
#      name: vsd-upgrade
#    when: inventory_hostname == groups['vsds'][0]
#
#  - name: Get VSD nodes network and monit information post VSD upgrade after enabling VSD API
#    any_errors_fatal: true
#    vars:
#      report_filename: vsd_post_vsd_upgrade_report.txt
#    include_role:
#      name: vsd-health
#    when: inventory_hostname in groups['vsds']
#  when: vsd_sa_or_ha == 'sa'
#
#- name: Get VSC nodes information prior to upgrade VSC1
#  any_errors_fatal: true
#  vars:
#    report_filename: vsc_pre_vsc1_upgrade_report.txt
#  include_role:
#    name: vsc-health
#  when: inventory_hostname in groups['vscs']

#- name: Backup VSC node1
#  any_errors_fatal: true
#  include_role:
#    name: vsc-backup
#  when: inventory_hostname in groups['vsc_ha_node1']
#
#- name: Prep VSC node1 for upgrade
#  any_errors_fatal: true
#  include_role:
#    name: vsc-preupgrade
#  when: inventory_hostname in groups['vsc_ha_node1']
#
#- name: Upgrade VSC node1
#  any_errors_fatal: true
#  include_role:
#    name: vsc-upgrade
#  when: inventory_hostname in groups['vsc_ha_node1']

- name: Get VSC nodes information post VSC1 upgrade
  any_errors_fatal: true
  vars:
    report_filename: vsc_post_vsc1_upgrade_report.txt
  include_role:
    name: vsc-health
  when: inventory_hostname in groups['vscs']
