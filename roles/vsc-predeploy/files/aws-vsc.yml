AWSTemplateFormatVersion: 2010-09-09
Description: >-
  AWS CloudFormation Template to deploy a VSC for access to VPC. **WARNING**
  This template creates an Amazon EC2 instance and ElasticIP. You will be billed
  for these AWS resources used if you create a stack from this template.
Parameters:
  KeyName:
    Description: Name of an existing EC2 KeyPair to enable SSH access to the instance
    Type: 'AWS::EC2::KeyPair::KeyName'
    ConstraintDescription: must be the name of an existing EC2 KeyPair.
  VscTargetServerEniId:
    Description: NetworkInterface ID for VSC target server interface
    Type: String
  VscDataEniId:
    Description: NetworkInterface ID for VSC Data interface
    Type: String
  VscMgmtEniId:
    Description: NetworkInterface ID for VSC Management interface
    Type: String
  AmiId:
    Description: AMI-ID for Instance
    Type: 'AWS::EC2::Image::Id'
    ConstraintDescription: AMI must already be availabe in this Region
  InstanceType:
    Description: EC2 instance type
    Type: String
    Default: i3.metal
    AllowedValues:
      - i3.metal
    ConstraintDescription: must be a valid EC2 instance type.
  InstanceName:
    Description: Enter Name for Instance
    ConstraintDescription: Instance Name
    Type: String
Resources:
  VscInstance:
    Type: 'AWS::EC2::Instance'
    Properties:
      InstanceType: !Ref InstanceType
      KeyName: !Ref KeyName
      ImageId: !Ref AmiId
      NetworkInterfaces:
        - DeviceIndex: '0'
          NetworkInterfaceId: !Ref VscTargetServerEniId
        - DeviceIndex: '1'
          NetworkInterfaceId: !Ref VscMgmtEniId
        - DeviceIndex: '2'
          NetworkInterfaceId: !Ref VscDataEniId
      UserData: ''
      Tags:
        - Key: Name
          Value: !Ref InstanceName
      BlockDeviceMappings:
        - DeviceName: /dev/sda1
          Ebs:
            DeleteOnTermination: true
Outputs:
  InstanceId:
    Description: InstanceId of the newly created EC2 instance
    Value: !Ref VscInstance
  AZ:
    Description: Availability Zone of the newly created EC2 instance
    Value: !GetAtt
      - VscInstance
      - AvailabilityZone
  PublicDNS:
    Description: Public DNSName of the newly created EC2 instance
    Value: !GetAtt
      - VscInstance
      - PublicDnsName
