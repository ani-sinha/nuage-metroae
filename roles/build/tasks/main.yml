---

# Refuse to run on Ansible 2.3, it has known bugs with connectivity
- name: Verify Ansible is not version 2.3 ( running {{ ansible_version.full }} )
  assert:
    that: "ansible_version.full | version_compare('2.2', '<=') or ansible_version.full | version_compare('2.4', '>=')"
    msg: >
      "Metro does not support Ansible 2.3 because of known bugs, please update to 2.4."
  tags: always

- include: get_paths.yml

- name: Clear host_vars directory
  file: path={{ playbook_dir }}/host_vars/ state=absent
  tags:
    - always

- name: Create the host_vars directory
  file: path={{ playbook_dir }}/host_vars/ state=directory
  tags:
    - always

- include: vsd_build_helper.yml

- include: vsc_build_helper.yml

- include: vstat_build_helper.yml

- include: vcin_build_helper.yml

- include: vnsutil_build_helper.yml

- include: nsgv_build_helper.yml
  tags:
   - nsgv

- include: vrs_build_helper.yml

- include: infra_build_helper.yml

- include: ci_build_helper.yml

- include: dns_build_helper.yml

- include: gvm_build_helper.yml

- include: osc_build_helper.yml

- include: os_compute_build_helper.yml

- include: vsr_build_helper.yml
  tags:
    - vsr

- name: Create hosts file
  template: src=hosts.j2 dest="{{ playbook_dir }}/hosts" backup=no
  tags:
    - always

- name: Create the group_vars directory
  file: path={{ playbook_dir }}/group_vars/ state=directory
  tags:
    - always
    
- name: Create group_vars/all file
  template: src=group_vars.all.j2 dest="{{ playbook_dir }}/group_vars/all" backup=no
  tags:
    - always
