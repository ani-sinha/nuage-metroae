---
# See BUILD.md for details

# First set of tasks is to gather_facts so that subsequent task list can use these facts as part of variable setting
- hosts: localhost
  gather_facts: yes
  tasks: []

# Actual tasks to generate build configuration
- hosts: localhost
  roles:
    - nuage-unpack
    - build
  vars:
    nuage_packed_src_path: "/mnt/nfs/nuage-releases/4.0R7/nuage-packed"
    nuage_unpacked_dest_path: "/mnt/nfs/nuage-releases/4.0R7/nuage-unpacked"
    nuage_already_unpacked: false
    nuage_target_architecture: {{ target_os }}
    vsd_standalone: true
    mycis:
      - { hostname: {{ target_server_name }},
          target_server_type: "heat",
          ci_image: ci-centos7,
          ci_flavor: jenkins }
      - { hostname: {{ vrs_u14_target_server_name }},
          target_server_type: "heat",
          ci_image: ci-ubuntu14,
          ci_flavor: jenkins }
      - { hostname: {{ vrs_u16_target_server_name }},
          target_server_type: "heat",
          ci_image: ci-ubuntu16,
          ci_flavor: jenkins }
    myvsds:
      - { hostname: {{ inventory_hostname }}-vsd1.example.com,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          mgmt_ip: {{ network_address }}.211,
          mgmt_gateway: {{ target_server }},
          mgmt_netmask: 255.255.255.0 }
    myvscs:
      - { hostname: {{ inventory_hostname }}-vsc1.example.com,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          mgmt_ip: {{ network_address }}.212,
          mgmt_gateway: {{ target_server }},
          mgmt_netmask_prefix: 24,
          ctrl_ip: 192.168.100.202,
          ctrl_netmask_prefix: 24,
          vsd_fqdn: {{ inventory_hostname }}-vsd1.example.com,
          system_ip: 1.1.1.2,
          xmpp_username: vsc1,
          vsc_static_route_list: { 0.0.0.0/1 } }
      - { hostname: {{ inventory_hostname }}-vsc2.example.com,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          mgmt_ip: {{ network_address }}.213,
          mgmt_gateway: {{ target_server }},
          mgmt_netmask_prefix: 24,
          ctrl_ip: 192.168.100.203,
          ctrl_netmask_prefix: 24,
          vsd_fqdn: {{ inventory_hostname }}-vsd1.example.com,
          system_ip: 1.1.1.3,
          xmpp_username: vsc2,
          vsc_static_route_list: { 0.0.0.0/1 } }
    dockermon_install: true
    myvrss:
      - { vrs_os_type: el7,
          vrs_ip_list: [{{ target_server | default("0.0.0.0") }}],
          active_controller_ip: {{ network_address }}.212,
          standby_controller_ip: {{ network_address }}.213 }
      - { vrs_os_type: u14.04,
          vrs_ip_list: [{{ vrs_u14_target_server | default("0.0.0.0") }}],
          active_controller_ip: {{ network_address }}.212,
          standby_controller_ip: {{ network_address }}.213 }
      - { vrs_os_type: u16.04,
          vrs_ip_list: [{{ vrs_u16_target_server | default("0.0.0.0") }}],
          active_controller_ip: {{ network_address }}.212,
          standby_controller_ip: {{ network_address }}.213 }
    myvstats:
      - { hostname: {{ inventory_hostname }}-vstat1.example.com,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          mgmt_ip: {{ network_address }}.214,
          mgmt_gateway: {{ target_server }},
          mgmt_netmask: 255.255.255.0,
          vsd_fqdn: {{ inventory_hostname }}-vsd1.example.com }
    myvnsutils:
      - { hostname: {{ inventory_hostname }}-vnsutil1.example.com,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          mgmt_ip: {{ network_address }}.215,
          mgmt_gateway: {{ target_server }},
          mgmt_netmask: 255.255.255.0,
          data_ip: 192.168.100.215,
          data_subnet: 192.168.100.0,
          data_netmask: 255.255.255.0,
          nsgv_ip: 192.168.100.216,
          nsgv_mac: '52:54:00:88:85:12',
          nsgv_hostname: {{ inventory_hostname }}-nsgv1.example.com,
          vsd_fqdn: {{ inventory_hostname }}-vsd1.example.com }
    mynsgvs:
      - { hostname: nsgv,
          target_server_type: "kvm",
          target_server: {{ target_server }},
          nsgv_mac: '52:54:00:88:85:12' }
    ansible_deployment_host: 10.106.0.2
    mgmt_bridge: "mgmt"
    data_bridge: "data"
    access_bridge: "access"
    images_path: "/var/lib/libvirt/images/"
    ntp_server_list:
      - {{ target_server }}
      - 192.96.202.120
    dns_server_list:
      - {{ target_server }}
      - 127.0.0.1
    dns_domain: example.com
    os_auth:
     username: admin
     password: admin
     project_name: jen
     auth_url: 'http://10.0.0.4:5000/v2.0'
