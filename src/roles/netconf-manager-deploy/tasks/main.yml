- block:

  - name: Set the RPM path temporarily
    set_fact: 
      rpm_path: /home/caso/nuage-images/netconf/

  - name: Set the RPM filename temporarily
    set_fact: 
      rpm_file_name: nuage-netconf-manager-6.0.3-26.el7.x86_64.rpm

  - name: Creates temporary netconf directory
    file:
      path: /tmp/netconfmanager
      state: directory

  - name: Copy the NETCONF Manager RPM file on the NETCONF Manager VM
    copy:
      dest: "/tmp/netconfmanager/{{ rpm_file_name }}"
      src: "{{ rpm_path }}/{{ rpm_file_name }}"
      mode: 0644
      owner: "root"
      group: "root"

  - name: yum -y localinstall nuage-netconf-manager-<number>.el7.x86_64.rpm
    yum:
      name: "/tmp/netconfmanager/{{ rpm_file_name }}"
      state: present

  - block:

    - name: Get the VSD truststore
      fetch:
        src: "/opt/vsd/jboss/standalone/configuration/vsd.truststore"
        dest: "/tmp/netconfmanager/"
        flat: yes

    - name: Get the Netconfmanager jks
      fetch:
        src: "/opt/vsd/ejbca/p12/netconfmgr.jks"
        dest: "/tmp/netconfmanager/"
        flat: yes
    delegate_to: vsds

  - name: Copy to netconf manager
    copy:
      dest: "/opt/netconfmanager/conf/"
      src: "/tmp/netconfmanager/"
    delegate_to: vsd1.example.met

  - name: Configure backend port numbers Port 61616 to be used for JMS messages. Port 7443 to be used for REST calls.
    command: ls

  - name: Configure front end port numbers 51515 MUST match `jms.port= in /opt/netconfmanager/conf/netconfmanager.properties 5666 MUST match `vsd.port in /opt/netconfmanager/conf/netconfmanager.properties
    command: ls

  - name: In /opt/netconfmanager/conf/netconfmanager.properties, edit the three parameters of the JMS Listener jms.queue jms.topic jms.user
    command: ls

  - name: Enable and start Docker
    service:
      name: netconfmanager
      state: started
      enabled: yes

  - name: Check the newly created Netconf Managers discovered in VSD, by opening the Open Monitoring Console window in VSD
    command: ls

  remote_user: root
