---
- hosts: vsd_node1
  gather_facts: no
  any_errors_fatal: true
  roles:
    - vsd-dbbackup
  vars:
    vsd_username: "{{ vsd_custom_username | default(vsd_default_username) }}"
    ansible_become_pass: "{{ vsd_custom_password | default(vsd_default_password) }}"
  become: "{{ 'no' if vsd_custom_username | default(vsd_default_username) == 'root' else 'yes' }}"
  remote_user: "{{ vsd_custom_username | default(vsd_default_username) }}"

- hosts: vsd_node1
  gather_facts: no
  any_errors_fatal: true
  vars:
    report_filename: vsd_ha_upgrade_backup_and_decouple_report.txt
    ansible_become_pass: "{{ vsd_custom_password | default(vsd_default_password) }}"
    vsd_username: "{{ vsd_custom_username | default(vsd_default_username) }}"
  roles:
    - vsd-decouple
  become: "{{ 'no' if vsd_custom_username | default(vsd_default_username) == 'root' else 'yes' }}"
  remote_user: "{{ vsd_custom_username | default(vsd_default_username) }}"
