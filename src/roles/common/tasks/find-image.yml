
- name: "Search for {{ pattern }} image File"
  find:
    path: "{{ nuage_unzipped_files_dir }}"
    patterns: "{{ pattern }}"
    recurse: yes
  register: rc_file

- debug: var=rc_file verbosity=1

- name: Verify no duplicate files are found
  assert:
    that: rc_file.matched < 2
    msg: "While searching for images, more than one file matched {{ pattern }} under {{ nuage_unzipped_files_dir }}"

- name: Register proper path and image locations for use in other playbooks
  set_fact:
    image_path: "{{ rc_file.files[0].path | dirname }}"
    image_file_name: "{{ rc_file.files[0].path | basename }}"
  when: rc_file.matched == 1

- name: Register that image files are missing
  set_fact:
    image_path: MISSING
    image_file_name: MISSING
    missing_image_file: true
  when: rc_file.matched <= 0
