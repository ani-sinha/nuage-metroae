---
- name: Run verification script for VSC
  local_action: command python {{ playbook_dir }}/scripts/vsc_verify.py {{ mgmt_ip }} {{ retry_timeout }} {{ playbook_dir }}/../
  register: pass

- name: Verification Result Failure Status
  fail: msg={{ pass.stdout }}
  when: pass.stdout | search("(?i)Error")

- name: Verification Result Success Status
  debug: var=pass.stdout

- name: Get VSC ntp status
  sros_command:
    commands:
      - show system ntp | match "Clock Source"
    provider: "{{ vsc_creds }}"
  delegate_to: localhost
  register: clock_source

- name: Verify ntp sync
  assert:
    that: "not clock_source.stdout[0] | search('none')"
    msg: "ntp sync check failed. Quitting."
