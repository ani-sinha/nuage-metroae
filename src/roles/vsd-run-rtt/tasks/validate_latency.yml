- name: Measure latency between current and other VSD
  shell: nping --tcp -p 3306 -c 10 {{ other_node }} | grep 'Max rtt:*' | cut -dm -f1 | sed 's/Max rtt://1'
  register: measured_rtt_latency
  delegate_to: "{{ delegate_node | default ('NONE') }}"

- name: Check if latency lower than required
  assert:
    that: "(measured_rtt_latency.stdout | int) < max_cluster_rtt_latency"
    msg: >-
      "RTT Latency between {{ other_node }} and {{ delegate_node | default(current_node) }} is higher than required.
      Quitting install. Recommended to use RTT cluster latency less than {{ max_cluster_rtt_latency }} milliseconds
      To ignore this error, set skip_vsd_cluster_rtt_test to true or adjust the value of max_cluster_rtt_latency in common.yml file
      in your deployment and rerun the MetroAE command again"
