- name: Pull facts of localhost
  connection: local
  action: setup

- name: get the username running the deploy
  local_action: command whoami
  register: username_on_the_host

- debug: var=username_on_the_host verbosity=1

- name: get the primary group for the username
  local_action: command id -gn "{{ username_on_the_host.stdout }}"
  register: groupname_on_the_host

- debug: var=groupname_on_the_host verbosity=1

- name: Set name of backup directory
  set_fact:
    vsd_localhost_backup_dir: "{{ metro_backup_root }}/backup-{{ inventory_hostname }}-{{ ansible_date_time.iso8601_basic_short }}/"

- name: Create the backup directory
  file:
    path: "{{ vsd_localhost_backup_dir }}"
    state: directory
    mode: 0755
    owner: "{{ username_on_the_host.stdout }}"
    group: "{{ groupname_on_the_host.stdout }}"
  delegate_to: localhost
  run_once: true
