---
- hosts: localhost
  vars:
    report_filename: ./vsd_pre_upgrade_report.txt
 
  tasks:
  - name: Clean up tmp files from previous runs
    file: path="{{ report_filename }}" state=absent
  - name: Write title to report file
    nuage_append: filename="{{ report_filename }}" text="VSD Pre-Upgrade Report Start\n"
  - name: Write date to report file
    nuage_append: filename="{{ report_filename }}" text="{{ ansible_date_time.date }}@{{ ansible_date_time.time }}\n"
  - name: Write seperator to report file
    nuage_append: filename="{{ report_filename }}" text="================================================================================\n"
 
- hosts: vsds
  gather_facts: no
  any_errors_fatal: true
  vars:
    report_filename: ./vsd_pre_upgrade_report.txt
  roles:
    - vsd-preupgrade

- hosts: localhost
  vars:
    report_filename: ./vsd_pre_upgrade_report.txt
  tasks:
  - name: Write seperator to report file
    nuage_append: filename="{{ report_filename }}" text="#================================================================================\n"
  - name: Write out footer
    nuage_append: filename="{{ report_filename }}" text="#VSD Pre-Upgrade Report End\n"

