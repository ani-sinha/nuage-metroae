- block:

  - name: Create local temp directory
    tempfile:
      state: directory
      path: "{{ lookup('env', 'TMPDIR') | default('/tmp/', true) }}"
    delegate_to: localhost
    register: mktemp_output

  - name: Generate ISO file
    create_zfb_profile:
      nsgv_path: "{{ mktemp_output.path }}"
      fact_name: nsgv_already_configured
      vsd_license_file: "{{ vsd_license_file }}"
      vsd_auth: "{{ vsd_auth }}"
      zfb_constants: "{{ zfb_constants }}"
      zfb_proxy_user: "{{ zfb_proxy_user }}"
      zfb_nsg: "{{ zfb_nsg }}"
      zfb_ports: "{{ zfb_ports }}"
      zfb_nsg_infra: "{{ zfb_nsg_infra }}"
      zfb_vsc_infra: "{{ zfb_vsc_infra }}"

  delegate_to: localhost
