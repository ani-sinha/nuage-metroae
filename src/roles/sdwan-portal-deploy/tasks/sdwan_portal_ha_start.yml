- name: SD-WAN Portal 1 bootstrap
  command: /opt/vnsportal/cluster_bootstrap.sh
  when: inventory_hostname == first_cluster_node_to_install

- name: Wait for the Portal 1 bootstrap to complete
  shell: "docker logs vnsportal-cluster-bootstrap"
  register: log_output
  until: log_output.stdout.find("Ready for start up") != -1
  retries: 20
  delay: 5
  when: inventory_hostname == first_cluster_node_to_install

- name: SD-WAN Portal 2 start up
  command: /opt/vnsportal/start.sh
  when: inventory_hostname == second_cluster_node_to_install

- name: Wait for the Portal 2 start up to complete
  shell: curl -k http://localhost/vnsportal/health
  register: curl_output
  until: curl_output.stdout.find("UP") != -1
  retries: 30
  delay: 5
  when: inventory_hostname == second_cluster_node_to_install

- name: SD-WAN Portal 3 start up
  command: /opt/vnsportal/start.sh
  when: inventory_hostname == third_cluster_node_to_install

- name: SD-WAN Portal 1 start up
  command: /opt/vnsportal/start.sh
  when: inventory_hostname == first_cluster_node_to_install
